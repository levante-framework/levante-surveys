# Survey E2E Testing with Cypress

This directory contains end-to-end tests for validating that our survey JSON files work correctly with SurveyJS after translation processing.

## ğŸ¯ Purpose

These tests ensure that:
- Survey JSON files load and render without errors in SurveyJS
- Multilingual content is properly applied and functional
- Regional language variants work correctly
- Translation artifacts don't break survey functionality
- Survey completion workflows function properly

## ğŸ“ Structure

```
cypress/
â”œâ”€â”€ e2e/
â”‚   â””â”€â”€ surveys.cy.js          # Main survey tests
â”œâ”€â”€ fixtures/
â”‚   â”œâ”€â”€ child_survey.json      # Test survey files
â”‚   â”œâ”€â”€ parent_survey_*.json
â”‚   â””â”€â”€ teacher_survey_*.json
â”œâ”€â”€ support/
â”‚   â”œâ”€â”€ commands.js            # Custom Cypress commands
â”‚   â””â”€â”€ e2e.js                 # Support configuration
â””â”€â”€ README.md                  # This file
```

## ğŸ§ª Test Categories

### 1. Basic Functionality Tests
- Survey loading and rendering
- Question visibility and structure
- Error-free initialization

### 2. Multilingual Tests
- Language switching functionality
- Regional variant support (es_CO, de_CH, fr_CA, etc.)
- Translation completeness

### 3. Content Validation Tests
- No translation artifacts ({{, }}, [object Object])
- Proper text rendering
- No undefined/null values

### 4. Survey Completion Tests
- Form interaction (shorter surveys only)
- Progress tracking
- Submission workflows

### 5. Cross-Survey Consistency Tests
- Consistent multilingual structure
- Similar language support patterns

## ğŸ›  Custom Commands

### `cy.loadSurvey(surveyFile)`
Loads a survey JSON file from fixtures and creates a SurveyJS instance.

### `cy.verifySurveyRenders()`
Checks that the survey renders without errors and is visible.

### `cy.verifySurveyHasQuestions()`
Validates that the survey contains questions/elements.

### `cy.verifyMultilingualSupport(languages)`
Tests language switching functionality.

### `cy.completeSurvey()`
Attempts to fill out and complete a survey (for testing workflows).

## ğŸš€ Running Tests

### Prerequisites
1. Make sure survey files are up to date:
   ```bash
   npm run deploy-surveys:dev
   ```

2. Setup test files:
   ```bash
   npm run setup-test-surveys
   ```

### Running Tests

```bash
# Run all survey tests headlessly
npm run test:surveys

# Open Cypress UI for survey tests
npm run test:surveys:open

# Run all e2e tests
npm run test:e2e

# Open Cypress UI for all tests
npm run test:e2e:open
```

### Manual Testing
You can also manually test surveys by:
1. Running `npm run dev`
2. Visiting `http://localhost:5173/survey-test`
3. Selecting different surveys and languages

## ğŸ“‹ Test Data

Tests use the `*_updated.json` files generated by the translation pipeline:
- These contain the latest multilingual content
- Regional language variants are preserved
- All translation processing is applied

## ğŸ”§ Configuration

### Cypress Config (`cypress.config.js`)
- Base URL: `http://localhost:5173`
- Viewport: 1280x720
- Screenshots on failure enabled
- Video recording disabled (for performance)

### Test Environment
- Tests expect the Vue dev server to be running
- Survey files are served from `/public/surveys/`
- SurveyJS libraries must be loaded in the application

## ğŸ› Troubleshooting

### Common Issues

1. **Survey files not found**
   ```bash
   npm run setup-test-surveys
   ```

2. **SurveyJS not loaded**
   - Ensure the app is running (`npm run dev`)
   - Check that survey-vue3-ui is properly imported

3. **Language switching fails**
   - Verify multilingual content exists in survey JSON
   - Check that regional variants are properly formatted

4. **Tests timing out**
   - Increase timeout in test configuration
   - Check network tab for failed requests

### Debug Tips

1. Use `cy.debug()` to pause test execution
2. Check browser console for JavaScript errors
3. Inspect survey JSON structure in fixtures
4. Use Cypress UI for step-by-step debugging

## ğŸ¯ Integration with CI/CD

These tests can be integrated into your deployment pipeline:

```bash
# Full validation pipeline
npm run extract-surveys:all    # Extract latest translations
npm run import-surveys-combined # Apply translations
npm run test:surveys           # Validate survey functionality
npm run deploy-surveys:dev     # Deploy if tests pass
```

This ensures that translation changes don't break survey functionality before deployment.
